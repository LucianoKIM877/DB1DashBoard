<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025년도 국회도서관 원문DB 구축사업 대시보드</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            display: flex;
        }
        
        /* 사이드바 스타일 */
        .sidebar {
            width: 250px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .sidebar-header h2 {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .sidebar-time {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .sidebar-menu {
            padding: 20px 0;
        }
        
        .menu-item {
            padding: 15px 20px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .menu-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .menu-item.active {
            background: rgba(255,255,255,0.2);
            border-left: 4px solid white;
        }
        
        .menu-item i {
            margin-right: 10px;
        }
        
        .submenu {
            background: rgba(0,0,0,0.1);
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .submenu.show {
            max-height: 400px;
        }
        
        .submenu-item {
            padding: 12px 20px 12px 50px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }
        
        .submenu-item:hover {
            background: rgba(255,255,255,0.1);
        }
        
        .submenu-item.active {
            background: rgba(255,255,255,0.15);
            border-left: 3px solid white;
        }
        
        .arrow {
            transition: transform 0.3s;
            font-size: 12px;
        }
        
        .arrow.down {
            transform: rotate(90deg);
        }
        
        /* 메인 콘텐츠 영역 */
        .main-content {
            margin-left: 250px;
            flex: 1;
            padding: 20px;
        }
        
        .content-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .content-header h1 {
            color: #333;
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .content-header p {
            color: #666;
            font-size: 16px;
        }
        
        /* 페이지 섹션 */
        .page-section {
            display: none;
        }
        
        .page-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* 카드 스타일 */
        .card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        
        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        /* 테이블 스타일 */
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }
        
        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #555;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .status-leave {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-half {
            background: #fff3cd;
            color: #856404;
        }
        
        /* 팀별 작업 현황 그리드 */
        .work-status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .team-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .team-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }

        .team-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .team-count {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
        }
        
        .work-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .work-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .work-item h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .work-item p {
            color: #666;
            font-size: 14px;
            margin: 5px 0;
        }
        
        .serial-number {
            color: #0066cc;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        /* 통계 카드 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-card .number {
            color: #667eea;
            font-size: 32px;
            font-weight: bold;
        }
        
        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal-content {
            position: relative;
            background: white;
            margin: 50px auto;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border-radius: 15px;
            animation: slideDown 0.3s;
        }
        
        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }
        
        .modal-close:hover {
            color: #333;
        }
        
        .login-form input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        .login-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .login-btn:hover {
            transform: scale(1.02);
        }
        
        /* 관리자 섹션 */
        .admin-section {
            display: none;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .upload-section {
            margin-bottom: 20px;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 10px;
            text-align: center;
            position: relative;
        }

        .upload-section.dragover {
            border-color: #667eea;
            background-color: #f8f9ff;
        }
        
        .file-input {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        
        .file-label:hover {
            transform: scale(1.05);
        }

        .file-status {
            margin-top: 10px;
            font-size: 14px;
        }

        .success-message {
            color: #28a745;
            font-weight: bold;
        }

        .error-message {
            color: #dc3545;
            font-weight: bold;
        }

        .file-info {
            color: #666;
            margin-top: 5px;
            font-size: 12px;
        }
        
        /* 반응형 디자인 */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            
            .main-content {
                margin-left: 200px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- SheetJS 라이브러리 추가 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- 사이드바 -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>2025년도 국회도서관<br>원문DB 구축사업 DBⅠ</h2>
            <div class="sidebar-time" id="sidebarTime"></div>
        </div>
        
        <div class="sidebar-menu">
            <div class="menu-item active" onclick="showPage('workers')">
                <span>📊 작업자 현황</span>
            </div>
            
            <div class="menu-item" onclick="showPage('attendance')">
                <span>⏰ 출퇴근 현황</span>
            </div>
            
            <div class="menu-item" onclick="toggleSubmenu(this)">
                <span>💼 작업 현황</span>
                <span class="arrow">▶</span>
            </div>
            <div class="submenu" id="workSubmenu">
                <div class="submenu-item" onclick="showWorkTeam('all')">전체 현황</div>
                <div class="submenu-item" onclick="showWorkTeam('management')">사업관리팀</div>
                <div class="submenu-item" onclick="showWorkTeam('scan')">스캔팀</div>
                <div class="submenu-item" onclick="showWorkTeam('image')">이미지보정팀</div>
                <div class="submenu-item" onclick="showWorkTeam('toc')">TOC팀</div>
                <div class="submenu-item" onclick="showWorkTeam('check1')">점검1팀</div>
                <div class="submenu-item" onclick="showWorkTeam('check2')">점검2팀</div>
                <div class="submenu-item" onclick="showWorkTeam('check3')">점검3팀</div>
            </div>
            
            <div class="menu-item admin-menu" onclick="showPage('admin')" style="display: none;">
                <span>⚙️ 관리자</span>
            </div>
        </div>
    </div>
    
    <!-- 메인 콘텐츠 -->
    <div class="main-content">
        <!-- 작업자 현황 페이지 -->
        <div id="workersPage" class="page-section active">
            <div class="content-header">
                <h1>작업자 현황</h1>
                <p>전체 작업자 목록 및 상태</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>전체 작업자</h3>
                    <div class="number" id="totalWorkers">40</div>
                </div>
                <div class="stat-card">
                    <h3>현재 근무중</h3>
                    <div class="number" id="workingCount">30</div>
                </div>
                <div class="stat-card">
                    <h3>휴가/반차</h3>
                    <div class="number" id="leaveCount">2</div>
                </div>
            </div>
            
            <div class="card">
                <h2>작업자 목록</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>팀</th>
                                <th>ID</th>
                                <th>이름</th>
                                <th>IP</th>
                                <th>상태</th>
                            </tr>
                        </thead>
                        <tbody id="workerTableBody">
                            <!-- 동적 생성 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 출퇴근 현황 페이지 -->
        <div id="attendancePage" class="page-section">
            <div class="content-header">
                <h1>출퇴근 현황</h1>
                <p>오늘의 출퇴근 기록</p>
            </div>
            
            <div class="card">
                <h2>출퇴근 기록</h2>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>팀</th>
                                <th>이름</th>
                                <th>출근 시간</th>
                                <th>퇴근 시간</th>
                                <th>상태</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTableBody">
                            <!-- 동적 생성 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- 작업 현황 페이지 -->
        <div id="workPage" class="page-section">
            <div class="content-header">
                <h1 id="workPageTitle">전체 작업 현황</h1>
                <p id="workPageDesc">모든 팀의 작업 진행 상황</p>
            </div>
            
            <div class="card">
                <div id="workStatusContainer">
                    <!-- 동적 생성 -->
                </div>
            </div>
        </div>
        
        <!-- 관리자 페이지 -->
        <div id="adminPage" class="page-section admin-section">
            <div class="content-header">
                <h1>관리자 설정</h1>
                <p>시스템 관리 및 데이터 업로드</p>
            </div>
            
            <div class="card">
                <h2>데이터 관리</h2>
                
                <div class="upload-section" id="workerUploadSection">
                    <h3>작업자 정보 업로드</h3>
                    <input type="file" id="workerFile" class="file-input" accept=".xlsx,.xls,.csv">
                    <label for="workerFile" class="file-label">작업자 파일 선택</label>
                    <p style="margin-top: 10px; color: #666;">엑셀 파일을 업로드하세요 (팀, ID, 이름, IP 열 필요)</p>
                    <div id="workerFileStatus" class="file-status"></div>
                </div>
                
                <div class="upload-section" id="workUploadSection">
                    <h3>작업 현황 업로드</h3>
                    <input type="file" id="workFile" class="file-input" accept=".xlsx,.xls,.csv">
                    <label for="workFile" class="file-label">작업 파일 선택</label>
                    <p style="margin-top: 10px; color: #666;">작업 데이터 엑셀 파일을 업로드하세요</p>
                    <div id="workFileStatus" class="file-status"></div>
                </div>
                
                <div style="margin-top: 20px;">
                    <h3>휴가/반차 설정</h3>
                    <select id="workerSelect" style="padding: 10px; margin: 10px;">
                        <option value="">작업자 선택</option>
                    </select>
                    <select id="leaveType" style="padding: 10px; margin: 10px;">
                        <option value="normal">정상 근무</option>
                        <option value="leave">연차</option>
                        <option value="morning">오전 반차</option>
                        <option value="afternoon">오후 반차</option>
                    </select>
                    <input type="date" id="leaveDate" style="padding: 10px; margin: 10px;">
                    <button onclick="setLeave()" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 5px; cursor: pointer;">설정</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 관리자 로그인 모달 -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">&times;</span>
            <h2 style="margin-bottom: 20px;">관리자 로그인</h2>
            <div class="login-form">
                <input type="password" id="adminPassword" placeholder="비밀번호 입력">
                <button class="login-btn" onclick="adminLogin()">로그인</button>
            </div>
        </div>
    </div>
    
    <script>
        // 전역 변수
        let workers = [
            // 사업관리팀
            {id: 'M001', name: '김관리', ip: '175.120.250.80', team: '사업관리팀'},
            {id: 'M002', name: '박매니저', ip: '175.120.250.81', team: '사업관리팀'},
            // 스캔팀
            {id: 'S001', name: '이스캔', ip: '175.120.250.82', team: '스캔팀'},
            {id: 'S002', name: '최디지털', ip: '175.120.250.83', team: '스캔팀'},
            // 이미지보정팀
            {id: 'E001', name: '박혜은', ip: '175.120.250.90', team: '이미지보정팀'},
            {id: 'E002', name: '양은정', ip: '175.120.250.91', team: '이미지보정팀'},
            {id: 'E003', name: '김동환', ip: '175.120.250.92', team: '이미지보정팀'},
            {id: 'E004', name: '양성배', ip: '175.120.250.93', team: '이미지보정팀'},
            {id: 'E005', name: '권용민', ip: '175.120.250.94', team: '이미지보정팀'},
            {id: 'E006', name: '장하늘', ip: '175.120.250.95', team: '이미지보정팀'},
            // TOC팀
            {id: 'T001', name: '이서연', ip: '175.120.250.96', team: 'TOC팀'},
            {id: 'T002', name: '최준호', ip: '175.120.250.97', team: 'TOC팀'},
            {id: 'T003', name: '김민지', ip: '175.120.250.98', team: 'TOC팀'},
            {id: 'T004', name: '박상현', ip: '175.120.250.99', team: 'TOC팀'},
            {id: 'T005', name: '정은아', ip: '175.120.250.100', team: 'TOC팀'},
            {id: 'T006', name: '한지민', ip: '175.120.250.101', team: 'TOC팀'},
            // 점검1팀
            {id: 'C101', name: '강민수', ip: '175.120.250.102', team: '점검1팀'},
            {id: 'C102', name: '신예진', ip: '175.120.250.103', team: '점검1팀'},
            {id: 'C103', name: '오성민', ip: '175.120.250.104', team: '점검1팀'},
            {id: 'C104', name: '임수빈', ip: '175.120.250.105', team: '점검1팀'},
            {id: 'C105', name: '조현우', ip: '175.120.250.106', team: '점검1팀'},
            {id: 'C106', name: '윤서영', ip: '175.120.250.107', team: '점검1팀'},
            // 점검2팀
            {id: 'C201', name: '송지훈', ip: '175.120.250.108', team: '점검2팀'},
            {id: 'C202', name: '김나영', ip: '175.120.250.109', team: '점검2팀'},
            {id: 'C203', name: '이재민', ip: '175.120.250.110', team: '점검2팀'},
            {id: 'C204', name: '박소연', ip: '175.120.250.111', team: '점검2팀'},
            {id: 'C205', name: '정다운', ip: '175.120.250.112', team: '점검2팀'},
            {id: 'C206', name: '홍길동', ip: '175.120.250.113', team: '점검2팀'},
            // 점검3팀
            {id: 'C301', name: '백승호', ip: '175.120.250.114', team: '점검3팀'},
            {id: 'C302', name: '안소희', ip: '175.120.250.115', team: '점검3팀'},
            {id: 'C303', name: '유진우', ip: '175.120.250.116', team: '점검3팀'},
            {id: 'C304', name: '황미란', ip: '175.120.250.117', team: '점검3팀'},
            {id: 'C305', name: '서동욱', ip: '175.120.250.118', team: '점검3팀'},
            {id: 'C306', name: '김하늘', ip: '175.120.250.119', team: '점검3팀'}
        ];
        
        let serialNumbers = [];
        let workerSerials = {};
        let leaveStatus = {};
        let isAdmin = false;
        let currentTeamView = 'all';
        
        // 시간 업데이트
        function updateTime() {
            const now = new Date();
            const timeString = now.toLocaleString('ko-KR', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            });
            document.getElementById('sidebarTime').textContent = timeString;
        }
        
        // 파일 업로드 이벤트 리스너 설정
        function setupFileUpload() {
            const workerFileInput = document.getElementById('workerFile');
            const workFileInput = document.getElementById('workFile');
            
            workerFileInput.addEventListener('change', function(e) {
                handleFileUpload(e, 'worker');
            });
            
            workFileInput.addEventListener('change', function(e) {
                handleFileUpload(e, 'work');
            });

            // 드래그 앤 드롭 지원
            setupDragAndDrop('workerUploadSection', 'workerFile', 'worker');
            setupDragAndDrop('workUploadSection', 'workFile', 'work');
        }

        // 드래그 앤 드롭 설정
        function setupDragAndDrop(sectionId, inputId, type) {
            const section = document.getElementById(sectionId);
            const input = document.getElementById(inputId);

            section.addEventListener('dragover', function(e) {
                e.preventDefault();
                section.classList.add('dragover');
            });

            section.addEventListener('dragleave', function(e) {
                e.preventDefault();
                section.classList.remove('dragover');
            });

            section.addEventListener('drop', function(e) {
                e.preventDefault();
                section.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    input.files = files;
                    handleFileUpload({ target: { files: files } }, type);
                }
            });
        }

        // 파일 업로드 처리
        function handleFileUpload(event, type) {
            const file = event.target.files[0];
            if (!file) return;

            const statusElement = document.getElementById(type + 'FileStatus');
            statusElement.innerHTML = `<div style="color: #007bff;">파일 읽는 중... (${file.name})</div>`;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    
                    // 첫 번째 워크시트 가져오기
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                    
                    if (type === 'worker') {
                        processWorkerData(jsonData, statusElement, file.name);
                    } else if (type === 'work') {
                        processWorkData(jsonData, statusElement, file.name);
                    }
                } catch (error) {
                    statusElement.innerHTML = `<div class="error-message">❌ 파일 읽기 오류: ${error.message}</div>`;
                }
            };
            
            reader.onerror = function() {
                statusElement.innerHTML = `<div class="error-message">❌ 파일을 읽을 수 없습니다.</div>`;
            };
            
            reader.readAsArrayBuffer(file);
        }

        // 작업자 데이터 처리
        function processWorkerData(data, statusElement, fileName) {
            try {
                if (data.length < 2) {
                    throw new Error('데이터가 충분하지 않습니다. 헤더와 최소 1개 행이 필요합니다.');
                }

                const headers = data[0].map(h => h ? h.toString().trim() : '');
                const rows = data.slice(1);

                // 필요한 열 찾기
                const teamCol = findColumnIndex(headers, ['팀', 'team', '부서']);
                const idCol = findColumnIndex(headers, ['id', 'ID', '아이디', '사번']);
                const nameCol = findColumnIndex(headers, ['이름', 'name', '성명']);
                const ipCol = findColumnIndex(headers, ['ip', 'IP', '아이피']);

                if (teamCol === -1 || idCol === -1 || nameCol === -1 || ipCol === -1) {
                    throw new Error('필수 열을 찾을 수 없습니다. (팀, ID, 이름, IP 열이 필요합니다)');
                }

                const newWorkers = [];
                let successCount = 0;
                let errorCount = 0;

                rows.forEach((row, index) => {
                    try {
                        if (row.length === 0 || !row[idCol] || !row[nameCol]) return;

                        const worker = {
                            team: (row[teamCol] || '').toString().trim(),
                            id: (row[idCol] || '').toString().trim(),
                            name: (row[nameCol] || '').toString().trim(),
                            ip: (row[ipCol] || '').toString().trim()
                        };

                        if (worker.team && worker.id && worker.name && worker.ip) {
                            newWorkers.push(worker);
                            successCount++;
                        }
                    } catch (error) {
                        errorCount++;
                    }
                });

                if (newWorkers.length === 0) {
                    throw new Error('유효한 작업자 데이터를 찾을 수 없습니다.');
                }

                // 기존 작업자 목록 업데이트
                workers = newWorkers;
                
                // UI 업데이트
                updateWorkerTable();
                updateAttendanceTable();
                updateWorkerSelect();
                updateWorkStatus();

                statusElement.innerHTML = `
                    <div class="success-message">✅ 업로드 완료!</div>
                    <div class="file-info">파일: ${fileName}</div>
                    <div class="file-info">성공: ${successCount}명, 실패: ${errorCount}명</div>
                `;

            } catch (error) {
                statusElement.innerHTML = `<div class="error-message">❌ 처리 오류: ${error.message}</div>`;
            }
        }

        // 작업 데이터 처리
        function processWorkData(data, statusElement, fileName) {
            try {
                if (data.length < 2) {
                    throw new Error('데이터가 충분하지 않습니다.');
                }

                const headers = data[0].map(h => h ? h.toString().trim() : '');
                const rows = data.slice(1);

                // 시리얼 번호 추출 (예시)
                const serialCol = findColumnIndex(headers, ['제어번호', 'serial', '시리얼', '번호']);
                
                if (serialCol !== -1) {
                    serialNumbers = rows
                        .map(row => row[serialCol])
                        .filter(serial => serial && serial.toString().trim())
                        .map(serial => serial.toString().trim());
                    
                    // 작업자에게 시리얼 번호 재할당
                    assignSerialNumbers();
                    updateWorkStatus();
                }

                statusElement.innerHTML = `
                    <div class="success-message">✅ 작업 데이터 업로드 완료!</div>
                    <div class="file-info">파일: ${fileName}</div>
                    <div class="file-info">처리된 행: ${rows.length}개</div>
                    ${serialNumbers.length > 0 ? `<div class="file-info">제어번호: ${serialNumbers.length}개</div>` : ''}
                `;

            } catch (error) {
                statusElement.innerHTML = `<div class="error-message">❌ 처리 오류: ${error.message}</div>`;
            }
        }

        // 열 인덱스 찾기 도우미 함수
        function findColumnIndex(headers, possibleNames) {
            for (let i = 0; i < headers.length; i++) {
                const header = headers[i].toLowerCase();
                for (let name of possibleNames) {
                    if (header.includes(name.toLowerCase())) {
                        return i;
                    }
                }
            }
            return -1;
        }
        
        // 페이지 전환
        function showPage(pageName) {
            // 모든 페이지 숨기기
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // 모든 메뉴 아이템 비활성화
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 선택한 페이지 표시
            if (pageName === 'workers') {
                document.getElementById('workersPage').classList.add('active');
                document.querySelectorAll('.menu-item')[0].classList.add('active');
            } else if (pageName === 'attendance') {
                document.getElementById('attendancePage').classList.add('active');
                document.querySelectorAll('.menu-item')[1].classList.add('active');
            } else if (pageName === 'admin' && isAdmin) {
                document.getElementById('adminPage').classList.add('active');
                document.querySelector('.admin-menu').classList.add('active');
            }
        }
        
        // 서브메뉴 토글
        function toggleSubmenu(menuItem) {
            const submenu = document.getElementById('workSubmenu');
            const arrow = menuItem.querySelector('.arrow');
            
            submenu.classList.toggle('show');
            arrow.classList.toggle('down');
            
            // 서브메뉴가 열리면 전체 현황 표시
            if (submenu.classList.contains('show')) {
                showWorkTeam('all');
            }
        }
        
        // 팀별 작업 현황 표시
        function showWorkTeam(team) {
            // 페이지 전환
            document.querySelectorAll('.page-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('workPage').classList.add('active');
            
            // 메뉴 활성화
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.menu-item')[2].classList.add('active');
            
            // 서브메뉴 아이템 활성화
            document.querySelectorAll('.submenu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentTeamView = team;
            
            // 제목 업데이트
            const titles = {
                'all': '전체 작업 현황',
                'management': '사업관리팀 작업 현황',
                'scan': '스캔팀 작업 현황',
                'image': '이미지보정팀 작업 현황',
                'toc': 'TOC팀 작업 현황',
                'check1': '점검1팀 작업 현황',
                'check2': '점검2팀 작업 현황',
                'check3': '점검3팀 작업 현황'
            };
            
            const descriptions = {
                'all': '모든 팀의 작업 진행 상황',
                'management': '사업관리팀 작업 진행 상황',
                'scan': '스캔팀 작업 진행 상황',
                'image': '이미지보정팀 작업 진행 상황',
                'toc': 'TOC팀 작업 진행 상황',
                'check1': '점검1팀 작업 진행 상황',
                'check2': '점검2팀 작업 진행 상황',
                'check3': '점검3팀 작업 진행 상황'
            };
            
            document.getElementById('workPageTitle').textContent = titles[team];
            document.getElementById('workPageDesc').textContent = descriptions[team];
            
            updateWorkStatus();
        }
        
        // 랜덤 시간 생성
        function getRandomTime(startHour, startMin, endHour, endMin) {
            const start = startHour * 60 + startMin;
            const end = endHour * 60 + endMin;
            const randomMin = Math.floor(Math.random() * (end - start + 1)) + start;
            const hour = Math.floor(randomMin / 60);
            const min = randomMin % 60;
            return `${String(hour).padStart(2, '0')}:${String(min).padStart(2, '0')}`;
        }
        
        // 출퇴근 시간 생성
        function generateAttendance(worker, date = new Date()) {
            const dateKey = date.toDateString();
            const leaveKey = `${worker.id}_${dateKey}`;
            
            if (leaveStatus[leaveKey]) {
                const status = leaveStatus[leaveKey];
                if (status === 'leave') {
                    return {name: worker.name, team: worker.team, checkIn: '연차', checkOut: '연차', status: 'leave'};
                } else if (status === 'morning') {
                    return {
                        name: worker.name,
                        team: worker.team,
                        checkIn: getRandomTime(13, 30, 14, 0),
                        checkOut: getRandomTime(17, 50, 18, 10),
                        status: 'morning'
                    };
                } else if (status === 'afternoon') {
                    return {
                        name: worker.name,
                        team: worker.team,
                        checkIn: getRandomTime(8, 30, 9, 0),
                        checkOut: getRandomTime(14, 0, 14, 10),
                        status: 'afternoon'
                    };
                }
            }
            
            return {
                name: worker.name,
                team: worker.team,
                checkIn: getRandomTime(8, 30, 9, 0),
                checkOut: getRandomTime(17, 50, 18, 10),
                status: 'normal'
            };
        }
        
        // 제어번호 할당
        function assignSerialNumbers() {
            workerSerials = {};
            
            let availableSerials = [...serialNumbers];
            workers.forEach(worker => {
                if (availableSerials.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableSerials.length);
                    workerSerials[worker.id] = availableSerials[randomIndex];
                    availableSerials.splice(randomIndex, 1);
                } else if (serialNumbers.length > 0) {
                    workerSerials[worker.id] = serialNumbers[Math.floor(Math.random() * serialNumbers.length)];
                }
            });
        }
        
        // 작업자 테이블 업데이트
        function updateWorkerTable() {
            const tbody = document.getElementById('workerTableBody');
            tbody.innerHTML = '';
            
            let workingCount = 0;
            let leaveCount = 0;
            
            workers.forEach(worker => {
                const attendance = generateAttendance(worker);
                
                if (attendance.status === 'leave') {
                    leaveCount++;
                } else {
                    workingCount++;
                }
                
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${worker.team}</td>
                    <td>${worker.id}</td>
                    <td>${worker.name}</td>
                    <td>${worker.ip}</td>
                    <td>${attendance.status === 'leave' ? 
                        '<span class="status-badge status-leave">연차</span>' : 
                        attendance.status === 'morning' ? 
                        '<span class="status-badge status-half">오전반차</span>' : 
                        attendance.status === 'afternoon' ? 
                        '<span class="status-badge status-half">오후반차</span>' : 
                        `<span style="color: #28a745;">근무중</span>`
                    }</td>
                `;
            });
            
            // 통계 업데이트
            document.getElementById('totalWorkers').textContent = workers.length;
            document.getElementById('workingCount').textContent = workingCount;
            document.getElementById('leaveCount').textContent = leaveCount;
        }
        
        // 출퇴근 테이블 업데이트
        function updateAttendanceTable() {
            const tbody = document.getElementById('attendanceTableBody');
            tbody.innerHTML = '';
            
            workers.forEach(worker => {
                const attendance = generateAttendance(worker);
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${attendance.team}</td>
                    <td>${attendance.name}</td>
                    <td>${attendance.checkIn}</td>
                    <td>${attendance.checkOut}</td>
                    <td><span class="status-badge ${attendance.status === 'leave' ? 'status-leave' : 
                        attendance.status === 'normal' ? '' : 'status-half'}">${
                        attendance.status === 'leave' ? '연차' : 
                        attendance.status === 'morning' ? '오전반차' : 
                        attendance.status === 'afternoon' ? '오후반차' : '정상'
                    }</span></td>
                `;
            });
        }
        
        // 작업 현황 업데이트
        function updateWorkStatus() {
            const container = document.getElementById('workStatusContainer');
            container.innerHTML = '';
            
            // 팀별 그룹화
            const teamMap = {
                'management': '사업관리팀',
                'scan': '스캔팀',
                'image': '이미지보정팀',
                'toc': 'TOC팀',
                'check1': '점검1팀',
                'check2': '점검2팀',
                'check3': '점검3팀'
            };
            
            if (currentTeamView === 'all') {
                // 전체 현황 - 팀별로 구분하여 표시
                const teamsToShow = ['사업관리팀', '스캔팀', '이미지보정팀', 'TOC팀', '점검1팀', '점검2팀', '점검3팀'];
                
                teamsToShow.forEach(teamName => {
                    const teamWorkers = workers.filter(w => w.team === teamName);
                    const workingWorkers = teamWorkers.filter(w => generateAttendance(w).status !== 'leave');
                    
                    if (workingWorkers.length > 0) {
                        // 팀 섹션 생성
                        const teamSection = document.createElement('div');
                        teamSection.className = 'team-section';
                        
                        const teamHeader = document.createElement('div');
                        teamHeader.className = 'team-header';
                        teamHeader.innerHTML = `
                            <div class="team-title">${teamName}</div>
                            <div class="team-count">${workingWorkers.length}명</div>
                        `;
                        teamSection.appendChild(teamHeader);
                        
                        // 팀원 그리드
                        const teamGrid = document.createElement('div');
                        teamGrid.className = 'work-status-grid';
                        
                        workingWorkers.forEach(worker => {
                            const div = document.createElement('div');
                            div.className = 'work-item';
                            const serialInfo = workerSerials[worker.id] ? 
                                `<p><strong>제어번호:</strong> <span class="serial-number">${workerSerials[worker.id]}</span></p>` : '';
                            
                            div.innerHTML = `
                                <h4>${worker.name} (${worker.id})</h4>
                                <p><strong>IP:</strong> ${worker.ip}</p>
                                ${serialInfo}
                                <p><strong>상태:</strong> 작업 중</p>
                            `;
                            teamGrid.appendChild(div);
                        });
                        
                        teamSection.appendChild(teamGrid);
                        container.appendChild(teamSection);
                    }
                });
            } else {
                // 특정 팀 현황
                const targetTeam = teamMap[currentTeamView];
                const teamWorkers = workers.filter(w => w.team === targetTeam);
                const workingWorkers = teamWorkers.filter(w => generateAttendance(w).status !== 'leave');
                
                const teamGrid = document.createElement('div');
                teamGrid.className = 'work-status-grid';
                
                workingWorkers.forEach(worker => {
                    const div = document.createElement('div');
                    div.className = 'work-item';
                    const serialInfo = workerSerials[worker.id] ? 
                        `<p><strong>제어번호:</strong> <span class="serial-number">${workerSerials[worker.id]}</span></p>` : '';
                    
                    div.innerHTML = `
                        <h4>${worker.name} (${worker.id})</h4>
                        <p><strong>IP:</strong> ${worker.ip}</p>
                        ${serialInfo}
                        <p><strong>상태:</strong> 작업 중</p>
                    `;
                    teamGrid.appendChild(div);
                });
                
                container.appendChild(teamGrid);
            }
        }
        
        // 관리자 로그인
        function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (password === 'admin1234') {
                isAdmin = true;
                document.querySelector('.admin-menu').style.display = 'block';
                closeModal();
                showPage('admin');
                updateWorkerSelect();
            } else {
                alert('❌ 비밀번호가 틀렸습니다.');
            }
        }
        
        // 작업자 선택 업데이트
        function updateWorkerSelect() {
            const select = document.getElementById('workerSelect');
            select.innerHTML = '<option value="">작업자 선택</option>';
            workers.forEach(worker => {
                const option = document.createElement('option');
                option.value = worker.id;
                option.textContent = `${worker.team} - ${worker.name} (${worker.id})`;
                select.appendChild(option);
            });
        }
        
        // 휴가 설정
        function setLeave() {
            const workerId = document.getElementById('workerSelect').value;
            const leaveType = document.getElementById('leaveType').value;
            const leaveDate = document.getElementById('leaveDate').value;
            
            if (!workerId || !leaveDate) {
                alert('작업자와 날짜를 선택하세요.');
                return;
            }
            
            const date = new Date(leaveDate);
            const dateKey = date.toDateString();
            const leaveKey = `${workerId}_${dateKey}`;
            
            if (leaveType === 'normal') {
                delete leaveStatus[leaveKey];
            } else {
                leaveStatus[leaveKey] = leaveType;
            }
            
            alert('설정이 완료되었습니다.');
            updateWorkerTable();
            updateAttendanceTable();
            updateWorkStatus();
        }
        
        // 모달 열기/닫기
        function openModal() {
            document.getElementById('loginModal').style.display = 'block';
        }
        
        function closeModal() {
            document.getElementById('loginModal').style.display = 'none';
            document.getElementById('adminPassword').value = '';
        }
        
        // 키보드 단축키
        let keySequence = [];
        document.addEventListener('keydown', function(e) {
            keySequence.push(e.key);
            keySequence = keySequence.slice(-6);
            
            // Ctrl+Shift+M
            if (e.ctrlKey && e.shiftKey && e.key === 'M') {
                openModal();
                e.preventDefault();
            }
            
            // 'admin' 입력
            if (keySequence.join('').toLowerCase().includes('admin')) {
                openModal();
                keySequence = [];
            }
        });
        
        // 초기화
        function init() {
            updateTime();
            setupFileUpload();
            assignSerialNumbers();
            updateWorkerTable();
            updateAttendanceTable();
            updateWorkStatus();
            
            // 1초마다 시간 업데이트
            setInterval(updateTime, 1000);
            
            // 20-40분마다 제어번호 재할당
            setInterval(() => {
                assignSerialNumbers();
                updateWorkerTable();
                updateWorkStatus();
            }, (Math.random() * 20 + 20) * 60 * 1000);
        }
        
        // 페이지 로드시 초기화
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>